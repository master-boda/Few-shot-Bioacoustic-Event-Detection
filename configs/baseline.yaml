# Paths
data_root: "data/raw"
train_metadata: "data/metadata/train.csv"
val_metadata: "data/metadata/val.csv"
work_dir: "experiments/baseline"

# Dataset / episodes
sample_rate: 22050
clip_duration: 5.0  # seconds
n_way: 3        # reduced to match available classes
k_shot: 1       # min clips per class in train: BV/HT (5), MT (2), WMW (161)
query_per_class: 1
episodes_per_epoch: 100
val_episodes: 50
window_seconds: 0.2
hop_seconds: 0.1
adaptive_window: true
adaptive_hop_ratio: 0.5
adaptive_min_seconds: null
adaptive_max_seconds: null

# Features
features:
  n_mels: 128
  n_fft: 512
  hop_length: 128
  f_min: 50
  f_max: 11025
  use_spectral_contrast: false
  spectral_contrast_bands: 6
  normalize: "minmax"

# Post-processing (few-shot detection)
postprocess:
  threshold: 0.0           # used when threshold_mode=global
  threshold_mode: "percentile"
  percentile: 99.5
  zscore: 2.5
  median_filter: 3         # frames (odd int), 0 to disable
  min_duration: 0.0        # seconds, drop shorter events (merge mode)
  min_duration_mode: "adaptive"
  adaptive_min_ratio: 0.6
  merge_gap: 0.0           # seconds, merge gaps shorter than this
  event_mode: "peak"       # peak or merge
  peak_distance: 0.25      # seconds between peaks
  event_duration: 0.0      # 0 uses mean support duration
  score_mode: "pos_vs_neg"
  bg_percentile: 10.0
  neg_samples: 50
  neg_iterations: 5

# Model
model:
  name: "prototypical"
  encoder: "imt_resnet"
  hidden_size: 64
  embedding_dim: 128
  num_blocks: 3
  channel_mult: 2

# Optimization
optimizer:
  name: "adam"
  lr: 0.001
  weight_decay: 0.0
scheduler:
  name: "step"
  step_size: 20
  gamma: 0.5

# Training
epochs: 50
episodes_per_epoch: 100
val_episodes: 50
num_workers: 20
seed: 42

# Per-file training (train_events.py)
train_events:
  support_per_file: 5
  negatives_per_file: 50
  max_pos_patches: 200
  support_strategy: "first"
  class_strategy: "max_pos"

# Performance knobs
performance:
  num_workers: 4
  pin_memory: true
  persistent_workers: true
  prefetch_factor: 2
  cache_wave: false
  amp: true
  cudnn_benchmark: true
